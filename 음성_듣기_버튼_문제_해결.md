# 음성 듣기 버튼 문제 해결 가이드 🎧

## 🔍 문제 분석

음성 듣기 버튼이 보이지 않는 문제는 다음과 같은 원인들로 발생할 수 있습니다:

1. **DOM 구조 불일치**: Jekyll 테마의 실제 DOM 구조와 TTS 플레이어가 기대하는 구조가 다름
2. **URL 매칭 실패**: 한국어 파일명이나 URL 인코딩 문제
3. **타이밍 문제**: DOM 요소가 완전히 로드되기 전에 스크립트가 실행됨
4. **오디오 파일 누락**: 대응하는 음성 파일이 없음

## ✅ 해결 방법

### 1. TTS 플레이어 코드 개선

다음과 같은 개선 사항을 적용했습니다:

#### 더 견고한 DOM 요소 감지
```javascript
// 이전: 제한적인 요소만 확인
const article = document.querySelector('article') || document.querySelector('.content');

// 개선: 여러 가능한 컨테이너 확인
const possibleContainers = [
    document.querySelector('article'),
    document.querySelector('.content'),
    document.querySelector('main'),
    document.querySelector('.post-content'),
    document.querySelector('#main-content'),
    document.querySelector('.container'),
    document.querySelector('body')
];
```

#### 개선된 URL 파싱
```javascript
// 이전: 단순한 정규식
const match = pageUrl.match(/\/notes\/([^\/]+)\//);

// 개선: URL 디코딩 및 여러 패턴 지원
let match = pageUrl.match(/\/notes\/([^\/]+)\/?$/);
if (match) {
    const fileName = decodeURIComponent(match[1]);
    return fileName;
}
```

### 2. 디버깅 기능 추가

문제 진단을 위한 콘솔 로그를 추가했습니다:

```javascript
console.log('TTS Player: DOM loaded, current path:', window.location.pathname);
console.log('TTS Player: Using container', container);
console.log('TTS Player: Checking audio for', pageUrl, 'filename:', audioFileName);
```

### 3. 이벤트 바인딩 개선

DOM 요소 생성 후 이벤트 바인딩이 되도록 지연 처리:

```javascript
setTimeout(() => {
    const playBtn = document.getElementById('tts-play-btn');
    // ... 이벤트 바인딩
}, 100);
```

## 🧪 문제 해결 테스트

### 1. 브라우저 개발자 도구 확인

1. **F12**를 눌러 개발자 도구를 엽니다
2. **Console** 탭을 확인합니다
3. 노트 페이지를 새로고침합니다
4. 다음과 같은 로그들이 나타나는지 확인합니다:

```
✅ 정상적인 로그:
TTS Player: DOM loaded, current path: /notes/테스트_노트/
TTS Player: Initializing for notes page
TTS Player initializing...
TTS Player: Using container <main class="...">
TTS Player: Inserting after title <h1>테스트 노트</h1>
TTS Player: Checking audio for /notes/테스트_노트/ filename: 테스트_노트
TTS Player: Full audio exists: true

❌ 문제가 있는 경우:
TTS Player: Not a notes page, skipping initialization
TTS Player: No suitable container found
TTS Player: Could not extract filename from URL
```

### 2. DOM 구조 확인

개발자 도구의 **Elements** 탭에서 다음을 확인합니다:

1. `<div id="tts-player">` 요소가 존재하는지
2. 버튼들이 올바르게 생성되었는지
3. CSS 스타일이 적용되었는지

### 3. 네트워크 요청 확인

**Network** 탭에서 다음을 확인합니다:

1. `/assets/audio/파일명.mp3` 파일 요청
2. 응답 상태 (200 OK 또는 404 Not Found)

## 🔧 수동 문제 해결

### 1. URL 경로 문제

노트 페이지의 URL이 `/notes/파일명/` 형태가 아닌 경우:

```javascript
// _config.yml 확인
collections:
  notes:
    output: true
    permalink: /notes/:title/
```

### 2. 오디오 파일 누락

해당 노트에 대응하는 오디오 파일이 없는 경우:

```bash
# 오디오 파일 확인
ls -la assets/audio/

# GitHub Actions 로그 확인
# Repository → Actions → TTS Conversion workflow
```

### 3. 수동 TTS 플레이어 테스트

콘솔에서 수동으로 플레이어를 생성해보세요:

```javascript
// 콘솔에서 실행
new TTSPlayer();

// 또는 폴백 기능 테스트
TTSFallback.speak('테스트 음성입니다.');
```

## 📋 체크리스트

음성 듣기 버튼이 보이지 않을 때 다음을 확인하세요:

- [ ] URL이 `/notes/파일명/` 형태인지
- [ ] 해당 파일의 오디오 파일(`assets/audio/파일명.mp3`)이 존재하는지
- [ ] 브라우저 콘솔에 오류 메시지가 없는지
- [ ] Jekyll 빌드가 성공적으로 완료되었는지
- [ ] GitHub Actions TTS 변환 워크플로우가 실행되었는지

## 🚀 추가 기능

### 1. 모든 포스트에서 TTS 지원

현재는 `/notes/` 경로에서만 작동하지만, 모든 포스트에서 사용하려면:

```javascript
// 조건 변경
if (window.location.pathname.includes('/notes/') || 
    window.location.pathname.includes('/posts/')) {
    new TTSPlayer();
}
```

### 2. 자동 재생 기능

페이지 로드 시 자동으로 음성을 재생하려면:

```javascript
// TTS 플레이어 초기화 후
setTimeout(() => {
    const playBtn = document.getElementById('tts-play-btn');
    if (playBtn && !playBtn.disabled) {
        playBtn.click();
    }
}, 2000);
```

### 3. 키보드 단축키

음성 재생을 위한 키보드 단축키:

```javascript
document.addEventListener('keydown', (e) => {
    if (e.ctrlKey && e.key === 'p') {
        e.preventDefault();
        const playBtn = document.getElementById('tts-play-btn');
        if (playBtn) playBtn.click();
    }
});
```

## 📞 문제 지속 시 대응

위 방법들로도 문제가 해결되지 않으면:

1. **브라우저 캐시 초기화**: Ctrl+Shift+R (또는 Cmd+Shift+R)
2. **다른 브라우저에서 테스트**: Chrome, Firefox, Safari 등
3. **모바일에서 테스트**: 반응형 UI 확인
4. **GitHub Actions 로그 확인**: TTS 변환 워크플로우 실행 상태
5. **Jekyll 로컬 빌드**: `bundle exec jekyll serve`로 로컬 테스트

## 📈 성능 최적화

### 1. 오디오 파일 압축

```python
# TTS 스크립트에서 압축률 조정
tts.save(output_path, mp3=True, bitrate="64k")
```

### 2. 지연 로딩

```javascript
// 오디오 파일을 필요할 때만 로드
const audio = new Audio();
audio.src = audioPath;
audio.preload = 'none';
```

### 3. 캐싱 활용

```javascript
// 오디오 파일 캐싱
const audioCache = new Map();
if (audioCache.has(audioPath)) {
    return audioCache.get(audioPath);
}
```

---

이 가이드를 통해 음성 듣기 버튼 문제를 해결하고, 더 나은 사용자 경험을 제공할 수 있습니다! 🎉

#public #tts #troubleshooting #음성학습 #버그수정