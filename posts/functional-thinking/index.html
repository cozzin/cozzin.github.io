<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Functional Thinking" /><meta property="og:locale" content="en" /><meta name="description" content="사실 함수형 사고 보다 RxSwift를 먼저 접하긴 했지만, 먼저 뿌리가 되는 함수형 프로그래밍 부터 알아보고 싶다는 생각이 들었다. RxSwift가 매력적인 프로그래밍 도구가 되어주는 것은 이해했지만, 아직도 남들을 설득하기에 기초가 되는 지식이 부족했기 때문이다." /><meta property="og:description" content="사실 함수형 사고 보다 RxSwift를 먼저 접하긴 했지만, 먼저 뿌리가 되는 함수형 프로그래밍 부터 알아보고 싶다는 생각이 들었다. RxSwift가 매력적인 프로그래밍 도구가 되어주는 것은 이해했지만, 아직도 남들을 설득하기에 기초가 되는 지식이 부족했기 때문이다." /><link rel="canonical" href="https://cozzin.github.io/posts/functional-thinking/" /><meta property="og:url" content="https://cozzin.github.io/posts/functional-thinking/" /><meta property="og:site_name" content="cozzin tech blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-10-28T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Functional Thinking" /><meta name="twitter:site" content="@_cozzin" /><meta name="google-site-verification" content="BX592gAt9i85NnZcSnLYnQWVTRN7wZy0vn94Bkx3wS4" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-01T13:05:27+00:00","datePublished":"2018-10-28T00:00:00+00:00","description":"사실 함수형 사고 보다 RxSwift를 먼저 접하긴 했지만, 먼저 뿌리가 되는 함수형 프로그래밍 부터 알아보고 싶다는 생각이 들었다. RxSwift가 매력적인 프로그래밍 도구가 되어주는 것은 이해했지만, 아직도 남들을 설득하기에 기초가 되는 지식이 부족했기 때문이다.","headline":"Functional Thinking","mainEntityOfPage":{"@type":"WebPage","@id":"https://cozzin.github.io/posts/functional-thinking/"},"url":"https://cozzin.github.io/posts/functional-thinking/"}</script><title>Functional Thinking | cozzin tech blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="cozzin tech blog"><meta name="application-name" content="cozzin tech blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="preconnect" href="https://cdnjs.cloudflare.com" ><link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.25.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://www.gravatar.com/avatar/dfaafc6813bb1a0c426f61cca77c7801?s=256" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/">cozzin tech blog</a></h1><p class="site-subtitle fst-italic mb-0">Dreaming of sustainable software development</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/notes/" class="nav-link"> <i class="fa-fw fas fa-sticky-note"></i> <span>NOTES</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/cozzin" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/_cozzin" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['hsh3592','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Functional Thinking</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><p>사실 함수형 사고 보다 RxSwift를 먼저 접하긴 했지만, 먼저 뿌리가 되는 함수형 프로그래밍 부터 알아보고 싶다는 생각이 들었다. RxSwift가 매력적인 프로그래밍 도구가 되어주는 것은 이해했지만, 아직도 남들을 설득하기에 기초가 되는 지식이 부족했기 때문이다.</p><h3 id="함수형-프로그래밍"><span class="me-2">함수형 프로그래밍</span><a href="#함수형-프로그래밍" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>미리 말해두고 싶은 것은 객체지향과 함수형은 서로 적대적인 관계가 아니라는 점이다. 코드의 재사용이라는 동일한 목표를 두고 다른 각도에서 바라보는 것이다. 저자가 책의 마지막 부분에서 말하고 있듯이, 다양한 패러다임을 연습해두고 문제에 맞는 방식을 채택하는 것이 좋다.</p><p>개발자들은 코드를 재사용하고 싶어한다. 클래스를 재사용하는 것에 초점을 맞춘 <a href="https://ko.wikipedia.org/wiki/%EA%B0%9D%EC%B2%B4_%EC%A7%80%ED%96%A5_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D">객체지향 프로그래밍</a>이 있고, 함수를 재사용하는 것에 초점을 맞춘 <a href="https://ko.wikipedia.org/wiki/%ED%95%A8%EC%88%98%ED%98%95_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D">함수형 프로그래밍</a>이 있다. 함수를 재사용하기 위해서는 함수를 사용할 때마다 다른 결과가 나와서는 안되겠다. 함수형 프로그래밍에서 <strong>불변성</strong>을 중요하게 생각하는 이유다.</p><h3 id="커링"><span class="me-2">커링</span><a href="#커링" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>객체지향에서 함수를 재사용할 방법을 고민하기 보다는 접근제어(private, public 등) 을 어떻게 하면 잘 나눌 수 있을지 고민한 적이 많은 것 같다. 내부에 추가적인 함수를 만들지 않고도 작업이 가능하다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">add</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="p">}</span>
</pre></table></code></div></div><p>위와 같은 함수가 있다고 가정하자. 항상 1 을 더해주는 함수는 어떻게 추가할 수 있을까?</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">addOne</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nf">add</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>모두가 알고 있듯이 이렇게 만들면 된다. 간단한 일이다. 하지만 항상 2, 3, 4, 5 를 추가해주는 함수도 필요하면 어떻게 될까? 4개의 추가적인 함수가 또 필요하다. 대신 이렇게 한번 해보자.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">add</span><span class="p">(</span><span class="n">_</span> <span class="nv">x</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span> <span class="n">y</span> <span class="k">in</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>이렇게 x를 먼저 받아두고 y는 나중에 받을 수 있도록 해주는 함수다. <strong>커링(currying)</strong>이라고 부른다. 1, 2, 3, 4, 5 를 더해주는 함수는 이렇게 만든다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">addOne</span> <span class="o">=</span> <span class="nf">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">addTwo</span> <span class="o">=</span> <span class="nf">add</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">addThree</span> <span class="o">=</span> <span class="nf">add</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">addFour</span> <span class="o">=</span> <span class="nf">add</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">addFive</span> <span class="o">=</span> <span class="nf">add</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></table></code></div></div><p>사용할 때는 이렇게 사용한다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nf">addOne</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1">// 11</span>
<span class="nf">addTwo</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1">// 12</span>
<span class="nf">addThree</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1">// 13</span>
<span class="nf">addFour</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1">// 14</span>
<span class="nf">addFive</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1">// 15</span>
</pre></table></code></div></div><p>저자는 부분함수와 커링의 개념을 좀 더 명확하게 구분하고자 했다. 간단히 보면 파라미터가 1개인 함수로 만들어주는 것을 커링, 나머지는 부분함수라고 이해했다. 커링의 개념을 조금 더 깊게 알고 싶다면 <a href="https://edykim.com/ko/post/writing-a-curling-currying-function-in-javascript/">이 글</a>을 참고하는 것도 도움이 될 것이다. Swift로 라이브러리 형태로 정리된 것은 <a href="https://github.com/thoughtbot/Curry">thoughtbot/Curry</a>가 있으니 사용해보는 것도 좋겠다.</p><h3 id="메모이제이션"><span class="me-2">메모이제이션</span><a href="#메모이제이션" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>내부의 상태를 저장하기 위해서 캐시를 사용하는 경우가 많다. 그 경우에 클래스 내부에서 캐싱을 한다. 이 경우 어디서 캐시를 사용하는지 고려해줘야 한다. 클래스 내부의 어떤 함수가 사용할 수도 있고 아닐 수도 있다. 잠재적인 오류를 품고 있는 것이다.</p><p>함수형 프로그래밍에서는 캐시를 함수 단위로 풀어가고자 한다. 함수의 리턴 값을 캐싱하는 방법인데 <strong>메모이제이션</strong>이라고 부른다. 메모이제이션을 사용하면 런타임에 최적화를 맡기게 되어서 성능 향상을 꾀할 수 있다. 그리고 메모이제이션 된 함수의 내부의 값을 다른 함수가 변경하는 것이 어렵기 때문에 잠재적인 오류를 줄일 수 있다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="n">memoize</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">:</span> <span class="kt">Hashable</span><span class="p">,</span> <span class="kt">U</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">function</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">U</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">cache</span> <span class="o">=</span> <span class="p">[</span><span class="kt">T</span><span class="p">:</span> <span class="kt">U</span><span class="p">]()</span>

    <span class="kd">func</span> <span class="nf">memoizedFunction</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">U</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">cachedValue</span> <span class="o">=</span> <span class="n">cache</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">cachedValue</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">cache</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">memoizedFunction</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">memoizedClassfier</span> <span class="o">=</span> <span class="nf">memoize</span><span class="p">(</span><span class="kt">Classifier</span><span class="o">.</span><span class="n">isPerfect</span><span class="p">)</span>
</pre></table></code></div></div><p>책을 읽으면서 메모이제이션을 swift로 구현해봤다. 위의 예제에서는 <code class="language-plaintext highlighter-rouge">func isPerfect() -&gt; Bool</code> 함수 자체를 캐싱한다. 재귀 상황에서도 사용할 수 있으면 좋겠다는 생각이 든다. <a href="https://www.youtube.com/watch?v=g44U1937o0g">애플의 WWDC 세션</a>에서 아래와 같은 코드를 소개했다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="n">memoize</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">:</span> <span class="kt">Hashable</span><span class="p">,</span> <span class="kt">U</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">((</span><span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">U</span><span class="p">,</span> <span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">U</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">memo</span> <span class="o">=</span> <span class="p">[</span><span class="kt">T</span><span class="p">:</span> <span class="kt">U</span><span class="p">]()</span>
    <span class="k">var</span> <span class="nv">result</span><span class="p">:</span> <span class="p">((</span><span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">U</span><span class="p">)</span><span class="o">!</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span> <span class="n">x</span> <span class="k">in</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">q</span> <span class="o">=</span> <span class="n">memo</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="p">{</span> <span class="k">return</span> <span class="n">q</span> <span class="p">}</span>
        <span class="k">let</span> <span class="nv">r</span> <span class="o">=</span> <span class="nf">body</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">memo</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
        <span class="k">return</span> <span class="n">r</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">factorial</span> <span class="o">=</span> <span class="n">memoize</span> <span class="p">{</span> <span class="n">factorial</span><span class="p">,</span> <span class="n">x</span> <span class="k">in</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
</pre></table></code></div></div><p>속도 비교도 함께 있어서 자세히 알고 싶은 사람은 <a href="https://greatgift.tistory.com/entry/Swift-Memoization">이 글</a>을 읽어보면 좋을 듯 하다. 책의 예제를 따라가면서 실제로 속도 향상이 있는지 궁금했고, 실무에도 적용할 수 있을지 고민해봤다.</p><h3 id="함수형-자료구조"><span class="me-2">함수형 자료구조</span><a href="#함수형-자료구조" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>함수형 언어는 부수효과가 없는 <strong>순수함수</strong>를 선호한다. 그리고 리턴 받은 값을 또 다시 함수에 넣을 수 있어야 좋다. 만약 함수가 예외를 발생시키면 이러한 특성을 깨뜨리게 된다. 그래서 보통 type-safe한 오류 처리방식을 도입한다.</p><p>책에서는 Either 라는 클래스를 소개하는데 swift에서는 모나드로 값을 한번 감싸서 구현할 수 있다. <a href="https://developer.apple.com/documentation/swift/optional">Optional</a>이나 <a href="https://github.com/antitypical/Result">Result</a>도 이와 같은 역할을 한다. unwrapping 하는 과정을 한번만 거치면 된다. Optional 구현부를 보면 아래와 값을 감싸게 되어있다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">enum</span> <span class="kt">Optional</span><span class="o">&lt;</span><span class="kt">Wrapped</span><span class="o">&gt;</span> <span class="p">:</span> <span class="kt">ExpressibleByNilLiteral</span> <span class="p">{</span>

    <span class="c1">/// The absence of a value.</span>
    <span class="c1">///</span>
    <span class="c1">/// In code, the absence of a value is typically written using the `nil`</span>
    <span class="c1">/// literal rather than the explicit `.none` enumeration case.</span>
    <span class="k">case</span> <span class="k">none</span>

    <span class="c1">/// The presence of a value, stored as `Wrapped`.</span>
    <span class="k">case</span> <span class="nf">some</span><span class="p">(</span><span class="kt">Wrapped</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Result는 이런식으로 구현하면 된다. 책에서 소개한 Either과 같다. Error 내용에 따라 처리해줘야 할 것이 있을 때는 Result를 사용하면 된다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">enum</span> <span class="kt">Result</span><span class="o">&lt;</span><span class="kt">Value</span><span class="p">,</span> <span class="kt">Error</span><span class="p">:</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">Error</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">ResultProtocol</span><span class="p">,</span> <span class="kt">CustomStringConvertible</span><span class="p">,</span> <span class="kt">CustomDebugStringConvertible</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nf">success</span><span class="p">(</span><span class="kt">Value</span><span class="p">)</span>
    <span class="k">case</span> <span class="nf">failure</span><span class="p">(</span><span class="kt">Error</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>에러를 바로 발생시키지 않는다는 개념이기 때문에, lazy를 구현하는데 도움이 된다. 에러의 내용을 확인하려면 한번 더 값을 열어봐야한다.</p><h3 id="lazy"><span class="me-2">Lazy</span><a href="#lazy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>이번엔 lazy에 대해서 알아보자. <strong>표현의 평가를 가능한 최대로 늦추는 기법</strong> 이라고 소개한다. 시간이 많이 걸리는 연산을 최대로 늦출 수 있고, 무한 컬렉션을 만들 수 있다. 자바에서는 이러한 무한 컬렉션을 Stream 으로 도입했고, 비슷한 개념을 RxSwift 에서 사용 가능하다.</p><p>사실 lazy 라는 것이 그렇게 새롭다고 느껴지진 않았다. swift에서 이미 많이 사용되고 있기 때문이다. UIView를 구성할 때 각 화면 요소들의 생성을 최대한 늦췄다가 필요할 때 생성해서 사용하기도 하고(lazy stored property), collection에 lazy를 적용해서 필요할 때만 값을 생성하거나 필터 하는 방법을 사용한다(<a href="https://developer.apple.com/documentation/swift/lazycollection">lazy collection</a>). lazy stored property에 대한 애플의 예제를 간단히 보자.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="kt">DataManager</span> <span class="p">{</span>
    <span class="kd">lazy</span> <span class="k">var</span> <span class="nv">importer</span> <span class="o">=</span> <span class="kt">DataImporter</span><span class="p">()</span>
    <span class="k">var</span> <span class="nv">data</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">]()</span>
    <span class="c1">// the DataManager class would provide data management functionality here</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">manager</span> <span class="o">=</span> <span class="kt">DataManager</span><span class="p">()</span>
<span class="n">manager</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"Some data"</span><span class="p">)</span>
<span class="n">manager</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"Some more data"</span><span class="p">)</span>
<span class="c1">// the DataImporter instance for the importer property has not yet been created</span>
</pre></table></code></div></div><p>가끔씩 사용되고 생성하는 비용이 크다면 <code class="language-plaintext highlighter-rouge">lazy</code> 키워드를 사용해서 생성을 미룰 수 있는 것이다. 위의 예제에서는 <code class="language-plaintext highlighter-rouge">importer</code> 가 아직 생성되지 않았다. 아래는 <a href="https://cocoacasts.com/what-is-a-lazymapcollection-in-swift">lazy collection에 대한 예제</a>이다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="k">var</span> <span class="nv">keys</span><span class="p">:</span> <span class="kt">LazyMapCollection</span><span class="o">&lt;</span><span class="kt">Dictionary</span><span class="p">,</span> <span class="kt">Key</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="kd">lazy</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">key</span> <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>lazy map을 사용해서 map을 연산할 필요가 있을 때만 연산한다. collection에 있는 모든 값에 대해 계산해주는 것이 아니라 사용되는 index의 값만 게산해서 반환하는 방법이다. 만약 collection에 많은 값들이 들어있고 key를 가져오는 것이 가끔 있는 일이라면 유용한 방법이 된다.</p><h3 id="함수-수준의-재사용"><span class="me-2">함수 수준의 재사용</span><a href="#함수-수준의-재사용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>글의 초반에 함수형 프로그래밍의 핵심이 함수의 재사용에 있다고 했다. 클래스에 패턴을 적용하는 객체지향처럼, 함수형 프로그래밍에서도 일종의 패턴이 있다.</p><h4 id="1-템플릿-메서드"><span class="me-2">1. 템플릿 메서드</span><a href="#1-템플릿-메서드" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>기존에 탬플릿 메서드에서는 아래와 같이 구현할 수 있다. 껍데기만 만들어두고 각 함수의 구현부는 클래스에게 맞기는 것이다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kd">protocol</span> <span class="kt">Customer</span> <span class="p">{</span>
    <span class="kd">associatedtype</span> <span class="kt">Item</span>

    <span class="k">var</span> <span class="nv">plan</span><span class="p">:</span> <span class="p">[</span><span class="kt">Item</span><span class="p">]</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">checkCredit</span><span class="p">()</span>
    <span class="kd">func</span> <span class="nf">checkInventory</span><span class="p">()</span>
    <span class="kd">func</span> <span class="nf">ship</span><span class="p">()</span>

    <span class="kd">func</span> <span class="nf">process</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Customer</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">process</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">checkCredit</span><span class="p">()</span>
        <span class="nf">checkInventory</span><span class="p">()</span>
        <span class="nf">ship</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>같은 기능을 수행하는 프로토콜을 만들어보자. 앞서서 3개의 함수를 클래스에서 반드시 구현해야 했다. 물론 checkCredit() { } 처럼 함수를 비워두는 방법도 있겠고, extension에서 구현부를 미리 비워두는 방법도 있겠지만 클로저를 사용한 아래의 방법이 조금 더 깔끔한 것을 알 수 있다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kd">protocol</span> <span class="kt">CustomerBlocks</span> <span class="p">{</span>
    <span class="kd">associatedtype</span> <span class="kt">Item</span>

    <span class="k">var</span> <span class="nv">plan</span><span class="p">:</span> <span class="p">[</span><span class="kt">Item</span><span class="p">]</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>

    <span class="k">var</span> <span class="nv">checkCredit</span><span class="p">:</span> <span class="p">(()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
    <span class="k">var</span> <span class="nv">checkInventory</span><span class="p">:</span> <span class="p">(()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
    <span class="k">var</span> <span class="nv">ship</span><span class="p">:</span> <span class="p">(()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">process</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">CustomerBlocks</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">process</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">checkCredit</span><span class="p">?()</span>
        <span class="nf">checkInventory</span><span class="p">?()</span>
        <span class="nf">ship</span><span class="p">?()</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>optional로 정의되어 있는 일급 함수들은 nil을 넣어서 생략할 수 있다. 그리고 함수를 호출하는 부분에서는 ? 라는 syntax sugar을 사용해서 간편하게 처리할 수 있다.</p><h4 id="2-전략strategy"><span class="me-2">2. 전략(Strategy)</span><a href="#2-전략strategy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>strategy pattern은 알고리즘을 바꿔서 사용할 수 있게 해주는 패턴이다. 곱셈을 두가지 방식으로 구현했다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kd">protocol</span> <span class="kt">Calc</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">product</span><span class="p">(</span><span class="nv">n</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">m</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">CalcMult</span><span class="p">:</span> <span class="kt">Calc</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">product</span><span class="p">(</span><span class="nv">n</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">m</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">m</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">CalcAdd</span><span class="p">:</span> <span class="kt">Calc</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">product</span><span class="p">(</span><span class="nv">n</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">m</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="p">(</span><span class="mi">1</span><span class="o">...</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">m</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>CalcMult과 CalcAdd의 결과값은 같다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="kt">StrategyTest</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">listOfStrategies</span><span class="p">:</span> <span class="p">[</span><span class="kt">Calc</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kt">CalcMult</span><span class="p">(),</span> <span class="kt">CalcAdd</span><span class="p">()]</span>

    <span class="kd">func</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">listOfStrategies</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="mi">10</span> <span class="o">==</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">product</span><span class="p">(</span><span class="nv">n</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nv">m</span><span class="p">:</span> <span class="mi">2</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>앞서 템플릿 메서드에서 사용했던 것처럼 일급 함수를 사용해보자. 함수를 바로 배열에 넣어서 사용했다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="kt">StrategyTest</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">testExp</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">listOfExp</span><span class="p">:</span> <span class="p">[(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="k">in</span> <span class="n">n</span> <span class="o">*</span> <span class="n">m</span><span class="p">},</span>
        <span class="p">{</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="k">in</span>
            <span class="k">var</span> <span class="nv">result</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="p">(</span><span class="mi">1</span><span class="o">...</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="n">m</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">result</span>
            <span class="p">}</span>
        <span class="p">]</span>

        <span class="n">listOfExp</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="mi">10</span> <span class="o">==</span> <span class="nv">$0</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="3-플라이웨이트-디자인-패턴과-메모이제이션"><span class="me-2">3. 플라이웨이트 디자인 패턴과 메모이제이션</span><a href="#3-플라이웨이트-디자인-패턴과-메모이제이션" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>플라이웨이트는 같은 종류의 모든 상품을 대표하는 <strong>표준객체</strong>라는 개념을 사용한다. 싱글톤에서 각 상품에 대한 정보를 공유한다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="kt">CompFactory</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">types</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Computer</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">sharedInstance</span><span class="p">:</span> <span class="kt">CompFactory</span> <span class="o">=</span> <span class="kt">CompFactory</span><span class="p">()</span>

    <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">types</span><span class="p">[</span><span class="s">"MacBookPro6_2"</span><span class="p">]</span> <span class="o">=</span> <span class="kt">Laptop</span><span class="p">()</span>
        <span class="n">types</span><span class="p">[</span><span class="s">"SunTower"</span><span class="p">]</span> <span class="o">=</span> <span class="kt">Desktop</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">ofType</span><span class="p">(</span><span class="n">_</span> <span class="nv">computer</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Computer</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">types</span><span class="p">[</span><span class="n">computer</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">testCompFactory</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">bob</span> <span class="o">=</span> <span class="kt">AssignedComputer</span><span class="p">(</span><span class="nv">computerType</span><span class="p">:</span> <span class="kt">CompFactory</span><span class="o">.</span><span class="n">sharedInstance</span><span class="o">.</span><span class="nf">ofType</span><span class="p">(</span><span class="s">"MacBookPro6_2"</span><span class="p">),</span> <span class="nv">userID</span><span class="p">:</span> <span class="s">"Bob"</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">steve</span> <span class="o">=</span> <span class="kt">AssignedComputer</span><span class="p">(</span><span class="nv">computerType</span><span class="p">:</span> <span class="kt">CompFactory</span><span class="o">.</span><span class="n">sharedInstance</span><span class="o">.</span><span class="nf">ofType</span><span class="p">(</span><span class="s">"MacBookPro6_2"</span><span class="p">),</span> <span class="nv">userID</span><span class="p">:</span> <span class="s">"Bob"</span><span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="n">bob</span><span class="o">.</span><span class="n">computerType</span> <span class="o">===</span> <span class="n">steve</span><span class="o">.</span><span class="n">computerType</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>각 type에 대한 정보를 캐시해두었다. 이 글의 앞부분에서 캐싱을 메모이제이션으로 대체할 수 있다고 했다. 그렇다면 플라이웨이트 패턴을 메모이제이션을 활용해서 만들어보자. memoize() 함수는 앞부분에서 구현했던 것을 그대로 사용했다. 싱글톤을 쓰지 않고도 보다 간결하게 표현할 수 있게 되었다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">testMemoize</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">computerOf</span><span class="p">:</span> <span class="p">(</span><span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Computer</span><span class="p">?</span> <span class="o">=</span> <span class="p">{</span> <span class="n">type</span> <span class="k">in</span>
        <span class="k">let</span> <span class="nv">of</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Computer</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">"MacBookPro6_2"</span><span class="p">:</span> <span class="kt">Laptop</span><span class="p">(),</span>
                                      <span class="s">"SunTower"</span><span class="p">:</span> <span class="kt">Desktop</span><span class="p">()]</span>
        <span class="k">return</span> <span class="n">of</span><span class="p">[</span><span class="n">type</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">computerOfType</span> <span class="o">=</span> <span class="nf">memoize</span><span class="p">(</span><span class="n">computerOf</span><span class="p">)</span>

    <span class="k">let</span> <span class="nv">bob</span> <span class="o">=</span> <span class="kt">AssignedComputer</span><span class="p">(</span><span class="nv">computerType</span><span class="p">:</span> <span class="nf">computerOfType</span><span class="p">(</span><span class="s">"MacBookPro6_2"</span><span class="p">),</span> <span class="nv">userID</span><span class="p">:</span> <span class="s">"Bob"</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">steve</span> <span class="o">=</span> <span class="kt">AssignedComputer</span><span class="p">(</span><span class="nv">computerType</span><span class="p">:</span> <span class="nf">computerOfType</span><span class="p">(</span><span class="s">"MacBookPro6_2"</span><span class="p">),</span> <span class="nv">userID</span><span class="p">:</span> <span class="s">"Bob"</span><span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="n">bob</span><span class="o">.</span><span class="n">computerType</span> <span class="o">===</span> <span class="n">steve</span><span class="o">.</span><span class="n">computerType</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="4-팩토리와-커링"><span class="me-2">4. 팩토리와 커링</span><a href="#4-팩토리와-커링" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>주어진 조건에 따라 다른 값을 리턴하는 것이 <strong>팩토리</strong> 의 본질이다. 이 글의 제일 앞부분에서 다뤘던 커링을 떠올려보자. 함수를 주어진 조건에 따라 다른 함수로 만든다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">addOne</span> <span class="o">=</span> <span class="nf">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">addTwo</span> <span class="o">=</span> <span class="nf">add</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">addThree</span> <span class="o">=</span> <span class="nf">add</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">addFour</span> <span class="o">=</span> <span class="nf">add</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">addFive</span> <span class="o">=</span> <span class="nf">add</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></table></code></div></div><h3 id="메타-프로그래밍"><span class="me-2">메타 프로그래밍</span><a href="#메타-프로그래밍" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>함수형 프로그래밍 개념을 제대로 지원하지 않는 언어나, 다른 라이브러리를 가져와서 사용하게 되는 경우에 메타프로그래밍을 통해 원하는 기능들로 매핑해서 사용하면 편리하다. swift에서는 extension을 활용하면 해당 객체나 구조체가 원래 가지고 있던 함수처럼 사용할 수 있다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">extension</span> <span class="kt">Reactive</span> <span class="k">where</span> <span class="kt">Base</span><span class="p">:</span> <span class="kt">UILabel</span> <span class="p">{</span>

    <span class="c1">/// Bindable sink for `text` property.</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">text</span><span class="p">:</span> <span class="kt">Binder</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">?</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">Binder</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">base</span><span class="p">)</span> <span class="p">{</span> <span class="n">label</span><span class="p">,</span> <span class="n">text</span> <span class="k">in</span>
            <span class="n">label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">/// Bindable sink for `attributedText` property.</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">attributedText</span><span class="p">:</span> <span class="kt">Binder</span><span class="o">&lt;</span><span class="kt">NSAttributedString</span><span class="p">?</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">Binder</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">base</span><span class="p">)</span> <span class="p">{</span> <span class="n">label</span><span class="p">,</span> <span class="n">text</span> <span class="k">in</span>
            <span class="n">label</span><span class="o">.</span><span class="n">attributedText</span> <span class="o">=</span> <span class="n">text</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>위의 예제는 <a href="https://github.com/ReactiveX/RxSwift/blob/master/RxCocoa/iOS/UILabel%2BRx.swift">RxSwift/RxCocoa/iOS/UILabel+Rx.swift</a>에서 가져온 것인데 기존의 UILabel을 함수형 개념으로 사용할 수 있도록 도와준다. 여기서 만들어서 사용한 것 처럼 진행하고 있는 프로젝트의 방향성에 맞게 확장해서 사용가능 하다는 장점이 있다.</p><h3 id="정리"><span class="me-2">정리</span><a href="#정리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>함수형 프로그래밍이 객체지향 프로그래밍과 완전히 등을 돌리고 있는것이 아니라는 것을 알았다.<li>사이드 이팩트가 많이 발생할 수 있는 부분에 함수형을 적용하면 좋다는 것을 알았다.<li>런타임에 양도하는 것이 중요한 개념이라는 것을 알게 되었다.<li>swift를 사용하면서 이미 많은 개념들을 함수형으로 사용하고 있다는 것을 알게되었다.<li>함수형에도 패턴이 있다는 것을 알게 되었다.<li>스트림을 무한한 컬렉션이라고 상상해보면 더 이해가 쉽다는 것을 알게되었다.<li>함수형으로 코드를 작성하는 것은 쉽지 않다.<li>하지만 제대로 사용하면 더 간결하고 안전한 코드를 얻을 수 있다는 것을 알게되었다.</ul><script src="/assets/js/tts-player.js"></script></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/app-store-deployment-experience-en/">Experiences of an App Store Deployment Manager - From Expedited Review to Scheduled Deployment</a><li class="text-truncate lh-lg"> <a href="/posts/trigger-circle-ci-from-github-comment/">Github Comment로 CircleCI 실행시키기</a><li class="text-truncate lh-lg"> <a href="/posts/app-store-deployment-experience/">앱 배포 담당자가 겪은 일들 - 긴급 심사부터 예약 배포까지</a><li class="text-truncate lh-lg"> <a href="/posts/codesoom-8week/">[코드숨] 스프링 회고</a><li class="text-truncate lh-lg"> <a href="/posts/create-aws-ec2-instance/">AWS EC2 생성하고 Github Repository Clone하기</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/spring/">Spring</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/combine/">combine</a> <a class="post-tag btn btn-outline-primary" href="/tags/app-store-connect/">App Store Connect</a> <a class="post-tag btn btn-outline-primary" href="/tags/app-store/">App Store</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">iOS</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">AWS</a> <a class="post-tag btn btn-outline-primary" href="/tags/circleci/">CircleCI</a> <a class="post-tag btn btn-outline-primary" href="/tags/cocoainternals/">CocoaInternals</a> <a class="post-tag btn btn-outline-primary" href="/tags/deployment-automation/">Deployment Automation</a></div></section></div></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/_cozzin">홍성호</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/spring/">Spring</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/combine/">combine</a> <a class="post-tag btn btn-outline-primary" href="/tags/app-store-connect/">App Store Connect</a> <a class="post-tag btn btn-outline-primary" href="/tags/app-store/">App Store</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">iOS</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">AWS</a> <a class="post-tag btn btn-outline-primary" href="/tags/circleci/">CircleCI</a> <a class="post-tag btn btn-outline-primary" href="/tags/cocoainternals/">CocoaInternals</a> <a class="post-tag btn btn-outline-primary" href="/tags/deployment-automation/">Deployment Automation</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.25.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-125862477-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-125862477-1'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
